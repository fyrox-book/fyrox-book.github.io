<!DOCTYPE HTML>
<html lang="en" class="navy sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Particle System Node - Fyrox Book</title>


        <!-- Custom HTML head -->
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-ETGWNBR03Y"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'G-ETGWNBR03Y');
        </script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Fyrox Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/fyrox-book/fyrox-book.github.io/tree/main" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/fyrox-book/fyrox-book.github.io/edit/main/src/scene/particle_system_node.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="particle-system"><a class="header" href="#particle-system">Particle system</a></h1>
<p>Particle system is a scene node that is used to create complex visual effects (VFX). It operates on huge amount
of particles at once allowing you to do complex simulation that involves large number of particles. Typically,
particle systems are used to create following visual effects: smoke, sparks, blood splatters, steam, etc.</p>
<p><img src="./particle_system_example.png" alt="smoke" /></p>
<h2 id="basic-concepts"><a class="header" href="#basic-concepts">Basic Concepts</a></h2>
<p>Particle system uses <em>single</em> texture for every particle in the system, only Red channel is used. Red channel interpreted
as an alpha for all particles.</p>
<p>Every particle is affected by <code>Acceleration</code> parameters of the particle system. It defines acceleration
(in m/s<sup>2</sup>) that will affect velocities of every particle. It is used to simulate gravity.</p>
<h3 id="particle"><a class="header" href="#particle">Particle</a></h3>
<p>Particle is a square (not quadrilateral, this is important) with a texture which is always facing towards camera. It
has the following properties:</p>
<ul>
<li><code>Position</code> - defines a position in <em>local</em> coordinates of particle system (this means that if you rotate a particle
system, all particles will be rotated too).</li>
<li><code>Velocity</code> - defines a speed vector (in local coordinates) that will be used to modify local position of the particle
each frame.</li>
<li><code>Size</code> - size (in meters) of the square shape of the particle.</li>
<li><code>Size Modifier</code> - a numeric value (in meters per second), that will be added to the Size at each frame, it is used
to modify size of the particles.</li>
<li><code>Lifetime</code> - amount of time (in seconds) that the particle can be active for.</li>
<li><code>Rotation</code> - angle (in radians) that defines rotation around particle-to-camera axis (clockwise).</li>
<li><code>Rotation Speed</code> - speed (in radians per second, rad/s) of rotation of the particle.</li>
<li><code>Color</code> - RGBA color of the particle.</li>
</ul>
<h3 id="emitters"><a class="header" href="#emitters">Emitters</a></h3>
<p>Particle system uses <em>emitters</em> to define a set of zones where particles will be spawned, it also defines initial ranges of
parameters of particles. Particle system must have at least one emitter to generate particles.</p>
<p>Emitter can be one of the following types:</p>
<ul>
<li><code>Cuboid</code> - emits particles uniformly in a cuboid shape, the shape cannot be rotated, only translated.</li>
<li><code>Sphere</code> - emits particles uniformly in a sphere shape.</li>
<li><code>Cylinder</code> - emits particle uniformly in a cylinder shape, the shape cannot be rotated, only translated.</li>
</ul>
<p>Each emitter have fixed set of parameters that affects <em>initial</em> values for every spawned particle:</p>
<ul>
<li><code>Position</code> - emitter have its own <em>local</em> position (position relative to parent particle system node), this helps you
to create complex particle systems that may spawn particles from multiple zones in space at once.</li>
<li><code>Max Particles</code> - maximum number of particles available for spawn. By default, it is <code>None</code>, which says that there is
no limit.</li>
<li><code>Spawn Rate</code> - rate (in units per second) defines how fast the emitter will spawn particles.</li>
<li><code>Lifetime Range</code> - numeric range (in seconds) for particle lifetime values. The lower the beginning of the range
the less spawned particles will live, and vice versa.</li>
<li><code>Size Range</code> - numeric range (in meters) for particle size.</li>
<li><code>Size Modifier Range</code> - numeric range (in meters per second, m/s) for particle size modifier parameter.</li>
<li><code>X/Y/Z Velocity Range</code> - a numeric range (in meters per second, m/s) for a respective velocity axis (X, Y, Z)
that defines initial speed along the axis.</li>
<li><code>Rotation Range</code> - a numeric range (in radians) for initial rotation of a new particle.</li>
<li><code>Rotation Speed Range</code> - a numeric range (in radians per second, rad/s) for rotation speed of a new particle.</li>
</ul>
<p><strong>Important:</strong> Every range (like Lifetime Range, Size Range, etc.) parameter generates <em>random</em> value for respective
parameter of a particle. You can tweak the seed of current random number generator (<code>fyrox::core::thread_rng()</code>) to
ensure that generated values will be different each time.</p>
<h2 id="how-to-create"><a class="header" href="#how-to-create">How to create</a></h2>
<p>There are multiple ways of creating a particle system, pick one that best suits your current needs.</p>
<h3 id="using-the-editor"><a class="header" href="#using-the-editor">Using the editor</a></h3>
<p>The best way to create a particle system is to configure it in the editor, creating from code is possible too (see below),
but way harder and may be not intuitive, because of the large number of parameters. The editor allows you see the result
and tweak it very fast. Create a particle system by <code>Create -&gt; Particle System</code> and then you can start editing its
properties. By default, new particle system has one Sphere particle emitter, you can add new emitters by clicking <code>+</code>
button at the right of <code>Emitters</code> property in the Inspector (or remove by clicking <code>-</code>). Here's a simple example:</p>
<p><img src="./particle_system.png" alt="particle system" /></p>
<p>Now start tweaking desired parameters, it is hard to give any recommendations of how to achieve a particular effect,
only practice matters here.</p>
<h3 id="using-the-code"><a class="header" href="#using-the-code">Using the code</a></h3>
<p>You can also create particle systems from code (in case if you need some procedurally-generated effects):</p>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn create_smoke(graph: &amp;mut Graph, resource_manager: &amp;mut ResourceManager, pos: Vector3&lt;f32&gt;) {
    let mut material = Material::standard_particle_system();
    material.bind(
        "diffuseTexture",
        Some(resource_manager.request::&lt;Texture&gt;("data/particles/smoke_04.tga")),
    );
    let material_resource = MaterialResource::new_ok(ResourceKind::Embedded, material);

    ParticleSystemBuilder::new(
        BaseBuilder::new()
            .with_lifetime(5.0)
            .with_local_transform(TransformBuilder::new().with_local_position(pos).build()),
    )
    .with_acceleration(Vector3::new(0.0, 0.0, 0.0))
    .with_color_over_lifetime_gradient({
        let mut gradient = ColorGradient::new();
        gradient.add_point(GradientPoint::new(0.00, Color::from_rgba(150, 150, 150, 0)));
        gradient.add_point(GradientPoint::new(
            0.05,
            Color::from_rgba(150, 150, 150, 220),
        ));
        gradient.add_point(GradientPoint::new(
            0.85,
            Color::from_rgba(255, 255, 255, 180),
        ));
        gradient.add_point(GradientPoint::new(1.00, Color::from_rgba(255, 255, 255, 0)));
        gradient
    })
    .with_emitters(vec![SphereEmitterBuilder::new(
        BaseEmitterBuilder::new()
            .with_max_particles(100)
            .with_spawn_rate(50)
            .with_x_velocity_range(-0.01..0.01)
            .with_y_velocity_range(0.02..0.03)
            .with_z_velocity_range(-0.01..0.01),
    )
    .with_radius(0.01)
    .build()])
    .with_material(material_resource)
    .build(graph);
}
<span class="boring">}</span></code></pre></pre>
<p>This code creates smoke effect with smooth dissolving (by using color-over-lifetime gradient). Please refer to
<a href="https://docs.rs/fyrox/latest/fyrox/scene/particle_system/index.html">API docs</a> for particle system for more information.</p>
<h3 id="using-prefabs"><a class="header" href="#using-prefabs">Using prefabs</a></h3>
<p>If you need to create particle systems made in the editor, you can always use prefabs. Create a scene with desired
particle system and then <a href="../resources/model.html#instantiation">instantiate</a> it to your scene.</p>
<h2 id="soft-particles"><a class="header" href="#soft-particles">Soft particles</a></h2>
<p>Fyrox used special technique, called soft particles, that smooths sharp transitions between particles and scene geometry:</p>
<p><img src="./soft_particles.png" alt="soft particles" /></p>
<p>This technique especially useful for effects such as smoke, fog, etc. where you don't want to see the "edge" between
particles and scene geometry. You can tweak this effect using <code>Soft Boundary Sharpness Factor</code>, the larger the value
the more "sharp" the edge will be and vice versa.</p>
<h2 id="restarting-emission"><a class="header" href="#restarting-emission">Restarting emission</a></h2>
<p>You can "rewind" particle systems in the "initial" state by calling <code>particle_system.clear_particles()</code> method, it
will remove all generated particles and emission will start over.</p>
<h2 id="enabling-or-disabling-particle-systems"><a class="header" href="#enabling-or-disabling-particle-systems">Enabling or disabling particle systems</a></h2>
<p>By default, every particle system is enabled. Sometimes there is a need to create a particle system, but not enable
it (for example for some delayed effect). You can achieve this by calling <code>particle_system.set_enabled(true/false)</code>
method. Disabled particle systems will still be drawn, but emission and animation will be stopped. To hide particle
system completely, use <code>particle_system.set_visibility(false)</code> method.</p>
<h2 id="performance"><a class="header" href="#performance">Performance</a></h2>
<p>Particle systems using special renderer that optimized to draw millions of particles with very low overhead, however
particles simulated on CPU side and may significantly impact overall performance when there are many particle systems
with lots of particles in each.</p>
<h2 id="limitations"><a class="header" href="#limitations">Limitations</a></h2>
<p>Particle systems does not interact with lighting, this means that particles will not be lit by light sources in the scene.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../scene/sprite_node.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../scene/terrain_node.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../scene/sprite_node.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../scene/terrain_node.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../editor.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
